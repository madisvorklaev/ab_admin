SELECT DISTINCT 'GRANT DELETE ON ' || O.NAME || ' TO ' || K.NAME || ';'
FROM KASUTAJA_GRUPIS K, GRUPI_OIGUSED O
WHERE K.GR_NIMI=O.GR_NIMI AND O.OIGUSED LIKE '%D%' AND
               K.ALATES<=SYSDATE AND (K.KUNI IS NULL OR K.KUNI>=SYSDATE) AND
               O.ALATES<=SYSDATE AND (O.KUNI IS NULL OR O.KUNI>=SYSDATE)
UNION
SELECT DISTINCT 'GRANT UPDATE ON ' || O.NAME || ' TO ' || K.NAME || ';'
FROM KASUTAJA_GRUPIS K, GRUPI_OIGUSED O
WHERE K.GR_NIMI=O.GR_NIMI AND O.OIGUSED LIKE '%U%' AND
               K.ALATES<=SYSDATE AND (K.KUNI IS NULL OR K.KUNI>=SYSDATE) AND
               O.ALATES<=SYSDATE AND (O.KUNI IS NULL OR O.KUNI>=SYSDATE)
UNION
SELECT DISTINCT 'GRANT INSERT ON ' || O.NAME || ' TO ' || K.NAME || ';'
FROM KASUTAJA_GRUPIS K, GRUPI_OIGUSED O
WHERE K.GR_NIMI=O.GR_NIMI AND O.OIGUSED LIKE '%I%' AND
               K.ALATES<=SYSDATE AND (K.KUNI IS NULL OR K.KUNI>=SYSDATE) AND
               O.ALATES<=SYSDATE AND (O.KUNI IS NULL OR O.KUNI>=SYSDATE)
UNION
SELECT DISTINCT 'GRANT SELECT ON ' || O.NAME || ' TO ' || K.NAME || ';'
FROM KASUTAJA_GRUPIS K, GRUPI_OIGUSED O
WHERE K.GR_NIMI=O.GR_NIMI AND O.OIGUSED LIKE '%S%' AND
               K.ALATES<=SYSDATE AND (K.KUNI IS NULL OR K.KUNI>=SYSDATE) AND
               O.ALATES<=SYSDATE AND (O.KUNI IS NULL OR O.KUNI>=SYSDATE)
UNION

SELECT DISTINCT 'REVOKE INSERT ON ' || O.NAME || ' FROM ' || K.NAME || ';'
FROM SYSUSERAUTH K, SYSTABLES O
WHERE O.NAME NOT LIKE 'SYS%' AND K.NAME NOT LIKE 'SYS%' AND
EXISTS (SELECT 1 FROM GRUPI_OIGUSED X, KASUTAJA_GRUPIS Y
WHERE X.OIGUSED='INSERT' AND  X.GR_NIMI=Y.GR_NIMI AND X.NAME=O.NAME AND Y.NAME=K.NAME AND
((X.ALATES <= SYSDATE AND  X.KUNI < SYSDATE) OR (Y.ALATES <= SYSDATE AND  Y.KUNI < SYSDATE)))

UNION
SELECT DISTINCT 'REVOKE SELECT ON ' || O.NAME || ' FROM ' || K.NAME || ';'
FROM SYSUSERAUTH K, SYSTABLES O
WHERE O.NAME NOT LIKE 'SYS%' AND K.NAME NOT LIKE 'SYS%' AND
EXISTS (SELECT 1 FROM GRUPI_OIGUSED X, KASUTAJA_GRUPIS Y
WHERE X.OIGUSED='SELECT' AND  X.GR_NIMI=Y.GR_NIMI AND X.NAME=O.NAME AND Y.NAME=K.NAME AND
((X.ALATES <= SYSDATE AND  X.KUNI < SYSDATE) OR (Y.ALATES <= SYSDATE AND  Y.KUNI < SYSDATE)))

UNION
SELECT DISTINCT 'REVOKE UPDATE ON ' || O.NAME || ' FROM ' || K.NAME || ';'
FROM SYSUSERAUTH K, SYSTABLES O
WHERE O.NAME NOT LIKE 'SYS%' AND K.NAME NOT LIKE 'SYS%' AND
EXISTS (SELECT 1 FROM GRUPI_OIGUSED X, KASUTAJA_GRUPIS Y
WHERE X.OIGUSED='UPDATE' AND  X.GR_NIMI=Y.GR_NIMI AND X.NAME=O.NAME AND Y.NAME=K.NAME AND
((X.ALATES <= SYSDATE AND  X.KUNI < SYSDATE) OR (Y.ALATES <= SYSDATE AND  Y.KUNI < SYSDATE)))

UNION
SELECT DISTINCT 'REVOKE DELETE ON ' || O.NAME || ' FROM ' || K.NAME || ';'
FROM SYSUSERAUTH K, SYSTABLES O
WHERE O.NAME NOT LIKE 'SYS%' AND K.NAME NOT LIKE 'SYS%' AND
EXISTS (SELECT 1 FROM GRUPI_OIGUSED X, KASUTAJA_GRUPIS Y
WHERE X.OIGUSED='DELETE' AND  X.GR_NIMI=Y.GR_NIMI AND X.NAME=O.NAME AND Y.NAME=K.NAME AND
((X.ALATES <= SYSDATE AND  X.KUNI < SYSDATE) OR (Y.ALATES <= SYSDATE AND  Y.KUNI < SYSDATE)));
